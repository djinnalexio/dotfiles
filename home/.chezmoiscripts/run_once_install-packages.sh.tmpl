#!/usr/bin/sh

echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Updating system packages:"
sudo sh -c "echo \
'[main]
gpgcheck=1
installonly_limit=2
clean_requirements_on_remove=True
best=False
skip_if_unavailable=True
fastestmirror=true
max_parallel_downloads=20
defaultyes=yes
' > /etc/dnf/dnf.conf"
echo "/etc/dnf/dnf.conf:"
cat /etc/dnf/dnf.conf
sudo dnf update -y --refresh

echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Installing programs for the shell:"
sudo dnf -y install \
    lsd \
    conda \
    cowsay \
    lolcat \
    fortune-mod \
    figlet \
    neofetch \
    git \
    git-lfs \
    neovim \
    pip

echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
git-lfs install

echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Installing vim-plug and setting up plugins for neovim:"
sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs \
       https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
sudo dnf -y install nodejs
nvim -c ':PlugInstall' -c ':qa'

{{- if (or (.shell.zshenabled) (.shell.plshellenabled)) }}
# download Nerd fonts if zsh or powerline-shell is enabled
echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Installing Nerd fonts:"
sudo dnf -y install powerline-fonts cascadia-code-pl-fonts cascadia-mono-pl-fonts
{{- end }}

{{- if (and (ne .chezmoi.username "root") (.shell.zshenabled)) }}
# User not root and ZSH enabled
echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Installing ZSH and setting it as the default shell:"
sudo dnf -y install zsh autojump
sudo usermod -s $(which zsh) $USER
{{- end }}

{{- if .shell.plshellenabled }}
# Powerline-Shell for bash enabled
echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Installing powerline-shell for bash:"
pip3 install --user powerline-shell
{{- end }}

{{- if (and (ne .chezmoi.username "root") (.shell.guienabled)) }}
# User not root and GUI apps enabled
echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Installing GUI applications:"
sudo dnf -y install \
    kitty \
    ulauncher

echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "Installing input-remapper:"
sudo dnf install python-devel -y
sudo pip install evdev -U
sudo pip install --no-binary :all: git+https://github.com/sezanzeb/input-remapper.git
sudo systemctl enable input-remapper
sudo systemctl restart input-remapper
{{- end }}
